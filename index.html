import React, { useState, useEffect } from 'react';
import { ChevronLeft, ChevronRight, BarChart3, Users, Target, CheckCircle2, BookOpen, Award, TrendingUp, Calendar, ArrowLeft, Printer, Briefcase } from 'lucide-react';

const SlideDeck = () => {
  const [currentSlide, setCurrentSlide] = useState(0);

  const totalSlides = 9;

  const nextSlide = () => {
    if (currentSlide < totalSlides - 1) setCurrentSlide(currentSlide + 1);
  };

  const prevSlide = () => {
    if (currentSlide > 0) setCurrentSlide(currentSlide - 1);
  };

  // Keyboard navigation
  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === 'ArrowLeft') nextSlide(); // RTL Logic
      if (e.key === 'ArrowRight') prevSlide(); // RTL Logic
      if (e.key === 'Space') nextSlide();
    };
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [currentSlide]);

  const handlePrint = () => {
    window.print();
  };

  const Header = () => (
    <div className="flex justify-between items-center py-4 px-8 border-b-4 border-[#006C35] bg-white shadow-sm print:border-b-2 print:py-2">
      <div className="flex flex-col text-right">
        <span className="text-xs text-gray-500 font-bold tracking-wider">المملكة العربية السعودية</span>
        <span className="text-sm font-bold text-[#006C35]">وزارة التعليم</span>
      </div>
      <div className="flex items-center gap-4">
        {/* Placeholder for Logos */}
        <div className="h-10 w-24 bg-gray-200 rounded flex items-center justify-center text-[10px] text-gray-500 font-bold border border-gray-300 print:grayscale">
           رؤية 2030
        </div>
        <div className="h-10 w-10 bg-[#006C35] rounded-full flex items-center justify-center text-white font-bold text-xs print:bg-black print:text-white">
          MOE
        </div>
      </div>
    </div>
  );

  const Footer = ({ slideNum }) => (
    <div className="absolute bottom-0 w-full py-2 px-8 bg-white border-t border-gray-200 flex justify-between items-center text-xs text-gray-500 print:relative print:border-none print:mt-auto">
      <span>مشروع الكوتشينج التعليمي (ضمن مستهدفات برنامج تمكين)</span>
      <div className="flex gap-2">
        <span>الشريحة {slideNum} من {totalSlides}</span>
      </div>
      <span>إعداد: أ. محمد علي عسيري</span>
    </div>
  );

  // --- Slides Content ---

  // Slide 1: Cover
  const Slide1 = () => (
    <div className="h-full flex flex-col justify-center items-center text-center space-y-8 animate-fadeIn p-8">
      <div className="w-24 h-24 bg-[#006C35] rounded-full flex items-center justify-center shadow-lg mb-4 print:shadow-none">
        <BookOpen className="text-white w-12 h-12" />
      </div>
      <h1 className="text-5xl font-extrabold text-[#006C35] leading-tight">
        مشروع الكوتشينج التعليمي
      </h1>
      <h2 className="text-2xl text-gray-600 font-medium max-w-2xl">
        بناء قدرات المعلمين وتحقيق الاستدامة المهنية
      </h2>
      <div className="inline-block bg-[#8DC63F] bg-opacity-20 text-[#006C35] px-4 py-2 rounded-full font-bold text-sm border border-[#8DC63F]">
        متوافق مع أهداف برنامج "تمكين" الوطني
      </div>
      <div className="mt-8 p-6 bg-white rounded-lg shadow-md border-r-4 border-[#8DC63F] print:shadow-none print:border">
        <p className="text-lg font-bold text-gray-800">إعداد وتقديم:</p>
        <p className="text-xl text-[#006C35] font-bold mt-2">محمد علي عبدالله عسيري</p>
        <p className="text-sm text-gray-500 mt-1">معلم خبير | كوتش محترف معتمد (PCC - ICF)</p>
      </div>
    </div>
  );

  // Slide 2: The Challenge (Data)
  const Slide2 = () => (
    <div className="h-full px-12 pt-8">
      <h2 className="text-3xl font-bold text-[#006C35] mb-2 border-b pb-2 inline-block">التحدي: فجوة الأثر</h2>
      <p className="text-gray-600 mb-12 text-lg">لماذا نحتاج إلى الانتقال من "التدريب" إلى "التمكين"؟</p>
      
      <div className="flex justify-center items-end gap-16 h-80 mt-8">
        {/* Bar 1 */}
        <div className="flex flex-col items-center group">
          <div className="text-xl font-bold text-gray-500 mb-2">10%</div>
          <div className="w-32 bg-gray-300 rounded-t-lg relative overflow-hidden h-[32px] print:h-[32px] border border-gray-400">
             <div className="absolute bottom-0 w-full h-full bg-gray-400 opacity-50"></div>
          </div>
          <p className="mt-4 font-bold text-gray-600 text-center">التدريب التقليدي</p>
          <p className="text-xs text-gray-400 mt-1">انتقال الأثر للفصل</p>
        </div>

        {/* Arrow */}
        <div className="mb-20 text-[#006C35]">
            <ArrowLeft size={40} strokeWidth={3} />
        </div>

        {/* Bar 2 */}
        <div className="flex flex-col items-center group">
          <div className="text-4xl font-extrabold text-[#006C35] mb-2">95%</div>
          <div className="w-32 bg-[#006C35] rounded-t-lg relative overflow-hidden h-[300px] print:h-[300px] shadow-xl print:shadow-none">
            <div className="absolute bottom-0 w-full h-full bg-gradient-to-t from-green-900 to-[#006C35]"></div>
          </div>
          <p className="mt-4 font-bold text-[#006C35] text-center text-lg">الكوتشينج (التمكين)</p>
          <p className="text-xs text-gray-500 mt-1">انتقال الأثر للفصل</p>
        </div>
      </div>
      <p className="text-left text-xs text-gray-400 mt-12">* المصدر: دراسات Joyce & Showers - الفرق بين التدريب والتطبيق</p>
    </div>
  );

  // Slide 3: The Solution (Comparison)
  const Slide3 = () => (
    <div className="h-full px-12 pt-8">
      <h2 className="text-3xl font-bold text-[#006C35] mb-8">الحل: منهجية الكوتشينج</h2>
      
      <div className="grid grid-cols-2 gap-8 mt-8">
        {/* Traditional */}
        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 opacity-70 print:opacity-100">
          <h3 className="text-xl font-bold text-gray-600 mb-6 flex items-center gap-2">
            <div className="w-2 h-8 bg-gray-400 rounded-full"></div>
            التوجيه التقليدي
          </h3>
          <ul className="space-y-4 text-gray-600 text-lg">
            <li className="flex items-center gap-3"><span className="text-red-400">✖</span> علاقة تبعية (رئيس/مرؤوس)</li>
            <li className="flex items-center gap-3"><span className="text-red-400">✖</span> تركيز على الملاحظات والأخطاء</li>
            <li className="flex items-center gap-3"><span className="text-red-400">✖</span> اعتماد كامل على الموجه الخارجي</li>
          </ul>
        </div>

        {/* Coaching */}
        <div className="bg-white p-6 rounded-xl border-t-4 border-[#8DC63F] shadow-lg transform scale-105 print:transform-none print:shadow-none print:border">
          <h3 className="text-xl font-bold text-[#006C35] mb-6 flex items-center gap-2">
            <div className="w-2 h-8 bg-[#8DC63F] rounded-full"></div>
            الكوتشينج (التمكين)
          </h3>
          <ul className="space-y-4 text-gray-800 text-lg font-medium">
            <li className="flex items-center gap-3"><CheckCircle2 className="text-[#8DC63F]" size={20} /> علاقة شراكة واستقلالية</li>
            <li className="flex items-center gap-3"><CheckCircle2 className="text-[#8DC63F]" size={20} /> تركيز على بناء القدرات والحلول</li>
            <li className="flex items-center gap-3"><CheckCircle2 className="text-[#8DC63F]" size={20} /> بناء خبرات ذاتية داخل المدرسة</li>
          </ul>
        </div>
      </div>
    </div>
  );

  // Slide 4: Strategic Alignment (Updated for Tamkeen)
  const Slide4 = () => (
    <div className="h-full px-12 pt-8">
      <h2 className="text-3xl font-bold text-[#006C35] mb-4">المواءمة مع مستهدفات "تمكين"</h2>
      <p className="text-gray-600 mb-10">إسقاط أهداف برنامج تمكين الوطني على البيئة التعليمية</p>

      <div className="grid grid-cols-3 gap-6">
        {/* Goal 1 */}
        <div className="bg-white p-6 rounded-xl shadow border border-gray-100 flex flex-col items-center text-center print:shadow-none print:border">
          <div className="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4">
            <Target className="text-blue-600" size={32} />
          </div>
          <h3 className="font-bold text-[#006C35] mb-1">من الاحتياج إلى الإنتاج</h3>
          <p className="text-xs text-gray-400 mb-3">(هدف تمكين الرئيسي)</p>
          <div className="w-full h-px bg-gray-200 mb-3"></div>
          <p className="text-sm text-gray-800 font-bold leading-relaxed">تحويل المعلم من "مستهلك" للدورات التدريبية إلى "منتج" للممارسات التعليمية الناجحة.</p>
        </div>

        {/* Goal 2 */}
        <div className="bg-white p-6 rounded-xl shadow border border-gray-100 flex flex-col items-center text-center print:shadow-none print:border">
          <div className="w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mb-4">
            <TrendingUp className="text-[#006C35]" size={32} />
          </div>
          <h3 className="font-bold text-[#006C35] mb-1">الاعتماد على الذات</h3>
          <p className="text-xs text-gray-400 mb-3">(الاستدامة)</p>
          <div className="w-full h-px bg-gray-200 mb-3"></div>
          <p className="text-sm text-gray-800 font-bold leading-relaxed">تمكين المدارس من قيادة تطويرها المهني ذاتياً عبر "الكوتش الداخلي" دون انتظار الدعم الخارجي.</p>
        </div>

        {/* Goal 3 */}
        <div className="bg-white p-6 rounded-xl shadow border border-gray-100 flex flex-col items-center text-center print:shadow-none print:border">
          <div className="w-16 h-16 bg-yellow-50 rounded-full flex items-center justify-center mb-4">
            <Briefcase className="text-yellow-600" size={32} />
          </div>
          <h3 className="font-bold text-[#006C35] mb-1">توفير الممكنات</h3>
          <p className="text-xs text-gray-400 mb-3">(التأهيل)</p>
          <div className="w-full h-px bg-gray-200 mb-3"></div>
          <p className="text-sm text-gray-800 font-bold leading-relaxed">تزويد المعلمين بأدوات الكوتشينج الحديثة التي تمكنهم من مواجهة تحديات الفصل بمهنية.</p>
        </div>
      </div>
    </div>
  );

  // Slide 5: Pilot Scope
  const Slide5 = () => (
    <div className="h-full px-12 pt-8 flex flex-col items-center">
      <h2 className="text-3xl font-bold text-[#006C35] mb-8 w-full text-right">نطاق مشروع الكوتشينج</h2>
      
      <div className="relative w-full max-w-4xl mt-8">
        <div className="absolute top-1/2 left-0 w-full h-2 bg-gray-200 -translate-y-1/2 z-0 rounded"></div>
        
        <div className="relative z-10 flex justify-between w-full">
          <div className="flex flex-col items-center bg-white p-2">
             <div className="w-20 h-20 bg-white border-4 border-[#006C35] rounded-full flex items-center justify-center text-2xl font-bold text-[#006C35] shadow-lg print:shadow-none">
                50
             </div>
             <p className="mt-4 font-bold text-gray-800">مدرسة (بيئة تمكين)</p>
          </div>

          <div className="flex flex-col items-center bg-white p-2">
             <div className="w-20 h-20 bg-white border-4 border-[#8DC63F] rounded-full flex items-center justify-center text-2xl font-bold text-[#8DC63F] shadow-lg print:shadow-none">
                70
             </div>
             <p className="mt-4 font-bold text-gray-800">كوتش (مُمكن)</p>
          </div>

          <div className="flex flex-col items-center bg-white p-2">
             <div className="w-20 h-20 bg-[#006C35] border-4 border-white rounded-full flex items-center justify-center text-2xl font-bold text-white shadow-lg print:shadow-none print:text-black print:border-[#006C35]">
                1
             </div>
             <p className="mt-4 font-bold text-gray-800">عام التأسيس</p>
          </div>
        </div>
      </div>

      <div className="mt-16 bg-blue-50 p-6 rounded-lg border border-blue-100 w-full text-center print:bg-white print:border-gray-300">
        <p className="text-blue-800 font-medium text-lg print:text-black">
          الغاية: تأسيس نموذج وطني للتمكين المهني داخل المدارس قابل للقياس والتعميم
        </p>
      </div>
    </div>
  );

  // Slide 6: Timeline
  const Slide6 = () => (
    <div className="h-full px-12 pt-8">
      <h2 className="text-3xl font-bold text-[#006C35] mb-8">الجدول الزمني (مسار التمكين)</h2>
      
      <div className="flex flex-col gap-6 w-full">
        <div className="flex items-center gap-4">
          <div className="w-32 text-sm font-bold text-gray-600">الشهر 1-2</div>
          <div className="flex-1 bg-gray-100 rounded-full h-12 relative overflow-hidden print:border print:bg-white">
            <div className="absolute top-0 right-0 h-full bg-blue-500 w-[20%] flex items-center px-4 text-white font-bold text-sm shadow print:bg-blue-200 print:text-black print:shadow-none">
              الإعداد والتأهيل
            </div>
          </div>
        </div>

        <div className="flex items-center gap-4">
          <div className="w-32 text-sm font-bold text-gray-600">الشهر 3-6</div>
          <div className="flex-1 bg-gray-100 rounded-full h-12 relative overflow-hidden print:border print:bg-white">
            <div className="absolute top-0 right-[20%] h-full bg-[#006C35] w-[60%] flex items-center px-4 text-white font-bold text-sm shadow print:bg-green-200 print:text-black print:shadow-none">
              جلسات الكوتشينج (التمكين الميداني)
            </div>
          </div>
        </div>

        <div className="flex items-center gap-4">
          <div className="w-32 text-sm font-bold text-gray-600">الشهر 7</div>
          <div className="flex-1 bg-gray-100 rounded-full h-12 relative overflow-hidden print:border print:bg-white">
            <div className="absolute top-0 right-[80%] h-full bg-orange-500 w-[20%] flex items-center px-4 text-white font-bold text-sm shadow print:bg-orange-200 print:text-black print:shadow-none">
              قياس أثر التمكين
            </div>
          </div>
        </div>
      </div>

      <div className="mt-8 grid grid-cols-3 gap-4 text-sm text-gray-500">
        <div className="flex items-center gap-2"><div className="w-3 h-3 bg-blue-500 rounded-full print:bg-blue-200"></div> تأهيل الكوتشز ومنحهم أدوات التمكين</div>
        <div className="flex items-center gap-2"><div className="w-3 h-3 bg-[#006C35] rounded-full print:bg-green-200"></div> تنفيذ دورات الكوتشينج ودعم المعلمين</div>
        <div className="flex items-center gap-2"><div className="w-3 h-3 bg-orange-500 rounded-full print:bg-orange-200"></div> قياس تحول المعلم من الاحتياج للإنتاج</div>
      </div>
    </div>
  );

  // Slide 7: KPIs
  const Slide7 = () => (
    <div className="h-full px-12 pt-8">
      <h2 className="text-3xl font-bold text-[#006C35] mb-8">مؤشرات نجاح التمكين (ROI)</h2>
      
      <div className="grid grid-cols-2 gap-8">
        <div className="bg-white p-6 rounded-lg shadow-md border-r-4 border-[#006C35] print:shadow-none print:border">
            <h3 className="font-bold text-lg text-gray-800 mb-2 flex items-center gap-2">
                <Target size={24} className="text-[#006C35]" />
                الكفاءة التدريسية
            </h3>
            <p className="text-gray-600 text-sm">ارتفاع مؤشر الممارسات الصفية الصحيحة (تحول المعلم لممارس خبير).</p>
            <div className="mt-4 flex gap-2">
                <span className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded print:border">المستهدف: +20%</span>
            </div>
        </div>

        <div className="bg-white p-6 rounded-lg shadow-md border-r-4 border-[#8DC63F] print:shadow-none print:border">
            <h3 className="font-bold text-lg text-gray-800 mb-2 flex items-center gap-2">
                <BarChart3 size={24} className="text-[#8DC63F]" />
                الأثر على الطالب
            </h3>
            <p className="text-gray-600 text-sm">تحسن نواتج التعلم كنتيجة مباشرة لتمكين المعلم.</p>
        </div>

        <div className="bg-white p-6 rounded-lg shadow-md border-r-4 border-yellow-500 print:shadow-none print:border">
            <h3 className="font-bold text-lg text-gray-800 mb-2 flex items-center gap-2">
                <Users size={24} className="text-yellow-500" />
                الاستقرار المهني
            </h3>
            <p className="text-gray-600 text-sm">ارتفاع الرضا الوظيفي والشعور بالدعم (بيئة عمل جاذبة).</p>
        </div>

        <div className="bg-white p-6 rounded-lg shadow-md border-r-4 border-blue-500 print:shadow-none print:border">
            <h3 className="font-bold text-lg text-gray-800 mb-2 flex items-center gap-2">
                <Calendar size={24} className="text-blue-500" />
                استدامة التنمية
            </h3>
            <p className="text-gray-600 text-sm">قدرة المدرسة على توليد حلول ذاتية للتحديات التربوية.</p>
        </div>
      </div>
    </div>
  );

   // Slide 8: Recommendations
   const Slide8 = () => (
    <div className="h-full px-12 pt-8">
      <h2 className="text-3xl font-bold text-[#006C35] mb-8">التوصيات (قرار التمكين)</h2>
      <div className="bg-[#006C35] bg-opacity-5 p-8 rounded-2xl border border-[#006C35] border-opacity-20 print:bg-white print:border-gray-300">
          <h3 className="text-xl font-bold text-gray-800 mb-6">لتحقيق أهداف التمكين في مدارسنا، نأمل:</h3>
          <ul className="space-y-6">
              <li className="flex items-start gap-4">
                  <div className="w-8 h-8 bg-[#006C35] text-white rounded-full flex items-center justify-center font-bold flex-shrink-0 print:text-black print:border">1</div>
                  <div>
                      <h4 className="font-bold text-lg text-gray-800">اعتماد مشروع "الكوتشينج التعليمي"</h4>
                      <p className="text-gray-600">كأحد مبادرات تمكين المعلم في 50 مدرسة تجريبية.</p>
                  </div>
              </li>
              <li className="flex items-start gap-4">
                  <div className="w-8 h-8 bg-[#006C35] text-white rounded-full flex items-center justify-center font-bold flex-shrink-0 print:text-black print:border">2</div>
                  <div>
                      <h4 className="font-bold text-lg text-gray-800">تسهيل مهام "الكوتش الممكن"</h4>
                      <p className="text-gray-600">منح صلاحيات وتفريغ جزئي للمعلمين الخبراء لقيادة العملية.</p>
                  </div>
              </li>
              <li className="flex items-start gap-4">
                  <div className="w-8 h-8 bg-[#006C35] text-white rounded-full flex items-center justify-center font-bold flex-shrink-0 print:text-black print:border">3</div>
                  <div>
                      <h4 className="font-bold text-lg text-gray-800">تشكيل لجنة قياس الأثر</h4>
                      <p className="text-gray-600">لضمان تحقيق مستهدفات التحول من الاحتياج إلى الإنتاج.</p>
                  </div>
              </li>
          </ul>
      </div>
    </div>
  );

  // Slide 9: Closing
  const Slide9 = () => (
    <div className="h-full flex flex-col justify-center items-center text-center space-y-8 p-8">
      <h1 className="text-4xl font-extrabold text-[#006C35] leading-snug max-w-4xl">
        "التمكين الحقيقي للمعلم يبدأ عندما يتحول<br />من متلقٍ للتوجيهات إلى قائد لنموه المهني"
      </h1>
      <p className="text-xl text-gray-600">
        الكوتشينج التعليمي هو بوابتنا لهذا التحول.
      </p>
      
      <div className="mt-12 text-right border-t pt-8 w-1/2 print:w-full">
        <p className="text-sm text-gray-500">للتواصل والاستفسار:</p>
        <p className="text-xl font-bold text-[#006C35] mt-1">محمد علي عبدالله عسيري</p>
        <p className="text-md text-gray-600">معلم خبير | كوتش محترف (PCC)</p>
      </div>

      <div className="mt-8 print:hidden">
          <button className="px-6 py-2 bg-[#006C35] text-white rounded hover:bg-green-800 transition-colors">
              شكراً لاستماعكم
          </button>
      </div>
    </div>
  );

  const slides = [Slide1, Slide2, Slide3, Slide4, Slide5, Slide6, Slide7, Slide8, Slide9];
  const CurrentSlideComponent = slides[currentSlide];

  return (
    <div dir="rtl" className="flex flex-col items-center justify-center min-h-screen bg-gray-100 font-sans p-4 print:p-0 print:bg-white">
      
      {/* --- PRINT STYLES --- */}
      <style>{`
        @media print {
          @page { size: landscape; margin: 0; }
          body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background: white; }
          .no-print { display: none !important; }
          .print-only { display: block !important; }
          .slide-page { break-after: page; page-break-after: always; height: 100vh; width: 100vw; display: flex; flex-direction: column; }
        }
        .print-only { display: none; }
      `}</style>

      {/* --- INTERACTIVE MODE (Screen) --- */}
      <div className="relative w-full max-w-5xl aspect-video bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col no-print">
        
        <Header />

        <div className="flex-1 relative overflow-hidden bg-white bg-[radial-gradient(#e5e7eb_1px,transparent_1px)] [background-size:16px_16px]">
          <div className="absolute inset-0 p-8 animate-fadeIn">
            <CurrentSlideComponent />
          </div>
        </div>

        <Footer slideNum={currentSlide + 1} />

        {/* Navigation Controls */}
        <div className="absolute bottom-4 left-8 flex gap-2 z-50">
           {/* Print Button */}
           <button 
            onClick={handlePrint}
            className="p-2 rounded-full bg-gray-700 text-white hover:bg-gray-900 transition-all shadow-lg mr-2"
            title="حفظ كـ PDF"
          >
            <Printer size={24} />
          </button>

           <button 
            onClick={prevSlide} 
            disabled={currentSlide === 0}
            className={`p-2 rounded-full ${currentSlide === 0 ? 'bg-gray-200 text-gray-400' : 'bg-[#006C35] text-white hover:bg-green-800'} transition-all shadow-lg`}
          >
            <ChevronRight size={24} />
          </button>
          
          <button 
            onClick={nextSlide} 
            disabled={currentSlide === totalSlides - 1}
            className={`p-2 rounded-full ${currentSlide === totalSlides - 1 ? 'bg-gray-200 text-gray-400' : 'bg-[#006C35] text-white hover:bg-green-800'} transition-all shadow-lg`}
          >
            <ChevronLeft size={24} />
          </button>
        </div>
      </div>

      {/* --- PRINT MODE (Hidden on Screen, Visible on Print) --- */}
      <div className="print-only w-full">
        {slides.map((SlideComponent, index) => (
          <div key={index} className="slide-page border-b relative">
            <Header />
            <div className="flex-1 p-12">
               <SlideComponent />
            </div>
            <div className="p-4 text-center text-xs text-gray-400 border-t">
               شريحة {index + 1}
            </div>
          </div>
        ))}
      </div>

      <div className="mt-4 text-gray-500 text-sm no-print">
        استخدم زر الطابعة (أو Ctrl+P) لحفظ العرض كملف PDF.
      </div>
    </div>
  );
};

export default SlideDeck;
